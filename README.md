### **Проектный бриф: Прототип гибридной архитектуры CTM-HRM для иерархических рассуждений**

#### **Ссылки:**
[**Continuous Thought Machines (CTM)**](https://github.com/SakanaAI/continuous-thought-machines) | [**Hierarchical Reasoning Model (HRM)**](https://github.com/sapientinc/HRM)

------

#### **1. Ключевая идея (Executive Summary)**

Проект нацелен на создание и проверку концепции (Proof of Concept) новой гибридной нейросетевой архитектуры, объединяющей **Continuous Thought Machines (CTM)** и **Hierarchical Reasoning Model (HRM)**.

Цель — построить модель, способную на многоуровневые рассуждения, комбинируя два фундаментально разных типа мышления:

1.  **Быстрый, интуитивный, непрерывный поток (обеспечивается CTM):** Способность обрабатывать временные последовательности, удерживать глобальный контекст и решать задачи, требующие долгосрочной памяти и планирования (например, навигация).
2.  **Медленный, логический, итеративный анализ (обеспечивается HRM):** Способность на любом шаге "потока" выполнять глубокие, аналитические вычисления для решения локальных, алгоритмически сложных подзадач (например, решение головоломок, удовлетворение ограничений).

Гибрид создает **пространственно-временную иерархию**: CTM управляет последовательностью "мысленных состояний" во времени, в то время как HRM обеспечивает необходимую глубину вычислений внутри каждого из этих состояний.

#### **2. Архитектура прототипа**

Прототип строится на основе архитектуры CTM, в которую вносится одно модульное изменение.

*   **Базовая архитектура:** Continuous Thought Machine (CTM) согласно оригинальной спецификации (Fig 2. в статье Sakana AI).
*   **Ключевое изменение:** Глобальный **блок (1) "SYNAPSE MODEL"** полностью заменяется на **модель HRM**.
    *   **Вход в HRM:** На вход HRM-блока подаются те же векторы, что и в оригинальную синаптическую модель:
        1.  `z^t`: Вектор пост-активаций с предыдущего `тика` (выход блока **(4)**).
        2.  `o^t`: Вектор текущего наблюдения, сформированный механизмом внимания (выход блока **(10)**).
    *   **Выход из HRM:** Выходом HRM является вектор **"пред-активаций" `a^t`**, который далее передается в **блок (2) "HISTORY (pre-activations)"** без изменений.
*   **Адаптивный `тик` CTM:** Вычислительный цикл CTM ("тик") **приостанавливается** до тех пор, пока внутренний итеративный процесс HRM не **сойдется к неподвижной точке (fixed point)**. Длительность каждого `тика` становится переменной и зависит от сложности подзадачи, решаемой HRM.
*   **Неизменные компоненты:** Все остальные блоки CTM (2-10), включая модели на уровне нейронов и механизм синхронизации/внимания, остаются без изменений.



![CTM architecture](https://pub.sakana.ai/ctm/assets/png/architecture.jpeg)



#### **3. Методология обучения**

Обучение гибридной модели является ключевым исследовательским аспектом.

*   **Прямой проход (Forward Pass):**
    1.  На каждом `тике` CTM, после формирования входов `z^t` и `o^t`, запускается внутренний итеративный цикл HRM.
    2.  HRM многократно обновляет свои внутренние состояния до тех пор, пока не будет выполнен критерий сходимости (например, L2-норма изменения скрытого состояния ниже порога ε).
    3.  Финальное состояние HRM используется для генерации `a^t`, после чего `тик` CTM завершается.
*   **Обратный проход (Backward Pass):**
    1.  Для обучения всей системы используется алгоритм обратного распространения ошибки во времени (BPTT) по `тикам` CTM.
    2.  При прохождении градиента через блок HRM, используется его собственный механизм обучения, основанный на **теореме о неявной функции**. Это позволяет вычислить аппроксимированный "одношаговый" градиент.
    3.  Этот аппроксимированный градиент используется как для обновления весов самой HRM (`∂Loss/∂θ_HRM`), так и для передачи градиента к предыдущим блокам CTM (`∂Loss/∂z^t`, `∂Loss/∂o^t`). *Поскольку на прямом проходе мы дождались сходимости, данная аппроксимация является математически корректной.*

#### **4. Требования к тестовой среде для Proof of Concept**

Цель PoC — доказать синергетический эффект гибрида. Идеальный тест должен обладать следующими тремя качествами, делающими его нерешаемым для CTM и HRM по отдельности:

1.  **Протяженность во времени и зависимость от контекста:** Задача требует долгосрочного планирования и удержания информации на протяжении многих `тиков`. Правильное действие на шаге `T` зависит от событий, произошедших на шаге `T-N`. *Это делает задачу нерешаемой для "безгражданственной" HRM.*
2.  **Локализованная алгоритмическая сложность:** В ключевые моменты времени для дальнейшего прогресса необходимо решить самодостаточную, логически сложную подзадачу, требующую итеративных вычислений и удовлетворения строгих ограничений. *Это делает задачу нерешаемой для "поверхностной" CTM.*
3.  **Неразрывная взаимосвязь:** Результат решения локальной сложной подзадачи является необходимым условием для продолжения глобальной задачи, и наоборот, контекст глобальной задачи необходим для правильной постановки локальной.

#### **5. Ожидаемые результаты и критерии успеха PoC**

*   **Основной критерий успеха:** Гибридная модель CTM-HRM успешно и стабильно решает задачи в тестовой среде, обладающей всеми тремя вышеописанными качествами.
*   **Обязательный контрольный критерий:** Оригинальные архитектуры CTM (с MLP) и HRM (в изоляции) терпят неудачу при решении той же задачи, демонстрируя неспособность справиться с одним из требуемых качеств.
*   **Второстепенные метрики:** На этапе PoC вычислительная скорость, эффективность по памяти и время обучения не являются ключевыми метриками. Главное — демонстрация принципиально новой функциональности.

#### **6. Ключевые риски и исследовательские вопросы**

*   **Вычислительная стоимость:** Ожидается, что прототип будет крайне медленным. Необходимо начинать с минимально возможных размеров моделей и тестовых сред.
*   **Сходимость обучения ("The Compositionality Challenge"):** Главный риск. Сможет ли система в процессе end-to-end обучения научиться эффективно декомпозировать задачу и сформировать стабильный "язык" коммуникации между CTM и HRM?
*   **Стабильность и гиперпараметры:** Потребуется тщательный подбор параметров обучения и критериев сходимости HRM для обеспечения стабильности всей системы.
